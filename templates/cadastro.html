<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nuar - Autenticação</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #110e25, #100c2b, #100a36); color: #fff; min-height: 100vh; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; }
        body::before { content: ''; position: fixed; inset: 0; background: radial-gradient(circle at 20% 80%, rgba(91, 72, 212, 0.1) 0%, transparent 50%), radial-gradient(circle at 80% 20%, rgba(124, 53, 236, 0.1) 0%, transparent 50%); pointer-events: none; }
        .decorative-shape { position: absolute; border-radius: 50%; opacity: 0.03; pointer-events: none; }
        .shape1 { width: 600px; height: 600px; background: linear-gradient(135deg, #8063e7, #5c45af); top: -300px; right: -200px; }
        .shape2 { width: 400px; height: 400px; background: linear-gradient(135deg, #7c35ec, #5c45af); bottom: -200px; left: -100px; }
        .auth-container { background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 30px; padding: 60px 50px; width: 100%; max-width: 480px; position: relative; z-index: 10; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5); }
        .logo { display: flex; justify-content: center; margin-bottom: 40px; }
        .logo img { height: 50px; filter: drop-shadow(0 0 10px rgba(91, 72, 212, 0.5)); }
        .auth-header { text-align: center; margin-bottom: 40px; }
        .auth-title { font-size: 32px; font-weight: 700; margin-bottom: 10px; background: linear-gradient(135deg, #fff, rgba(255, 255, 255, 0.8)); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; }
        .auth-subtitle { font-size: 15px; color: rgba(255, 255, 255, 0.6); }
        .auth-form { display: flex; flex-direction: column; gap: 20px; }
        .input-group { position: relative; }
        .auth-input { width: 100%; padding: 18px 55px 18px 20px; background: rgba(20, 20, 30, 0.8); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 50px; color: #fff; font-size: 15px; transition: all 0.3s; }
        .auth-input:focus { outline: none; border-color: rgba(128, 99, 231, 0.6); background: rgba(25, 20, 40, 0.9); box-shadow: 0 0 0 3px rgba(128, 99, 231, 0.1); }
        .auth-input::placeholder { color: rgba(255, 255, 255, 0.4); }
        .auth-options { display: flex; justify-content: space-between; align-items: center; font-size: 14px; margin-top: -5px; }
        .remember-me { display: flex; align-items: center; gap: 8px; cursor: pointer; color: rgba(255, 255, 255, 0.7); transition: color 0.3s; }
        .remember-me:hover { color: #fff; }
        .remember-me input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; accent-color: #5c45af; }
        .auth-submit { width: 100%; padding: 18px; background: linear-gradient(135deg, #5c45af, #7c35ec); border: 2px solid rgba(128, 99, 231, 0.3); border-radius: 50px; color: #fff; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 10px; position: relative; overflow: hidden; }
        .auth-submit::before { content: ''; position: absolute; inset: 0; background: linear-gradient(135deg, transparent, rgba(255, 255, 255, 0.1), transparent); transform: translateX(-100%); transition: transform 0.6s; }
        .auth-submit:hover::before { transform: translateX(100%); }
        .auth-submit:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(124, 53, 236, 0.4); border-color: rgba(128, 99, 231, 0.6); }
        .auth-submit:active { transform: translateY(0); }
        .auth-submit:disabled { opacity: 0.7; cursor: not-allowed; }
        .arrow-icon { width: 20px; height: 20px; border: 2px solid #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; }
        .auth-footer { text-align: center; margin-top: 30px; font-size: 15px; color: rgba(255, 255, 255, 0.7); }
        .auth-switch { color: #fff; text-decoration: none; font-weight: 600; cursor: pointer; transition: color 0.3s; border-bottom: 1px solid transparent; }
        .auth-switch:hover { color: #8063e7; border-bottom-color: #8063e7; }
        .terms-text { text-align: center; font-size: 13px; color: rgba(255, 255, 255, 0.5); margin-top: 25px; line-height: 1.6; }
        .terms-text a { color: rgba(255, 255, 255, 0.7); text-decoration: none; transition: color 0.3s; }
        .terms-text a:hover { color: #8063e7; }
        .error-message { background: rgba(220, 38, 38, 0.1); border: 1px solid rgba(239, 68, 68, 0.4); border-radius: 12px; padding: 15px 20px; color: #f87171; font-size: 14px; text-align: center; margin-top: 20px; animation: slideDown 0.4s ease-out; display: none; }
        .error-message.show { display: block; }
        .error-message.success { background: rgba(34, 197, 94, 0.1); border-color: rgba(34, 197, 94, 0.4); color: #4ade80; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .page-transition { animation: fadeInUp 0.6s ease-out; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        .hidden { display: none; }
        .confirm-modal { display: none; position: fixed; inset: 0; background: rgba(0, 0, 0, 0.85); z-index: 2002; align-items: center; justify-content: center; }
        .confirm-modal.active { display: flex; }
        .confirm-modal-content { background: rgba(17, 14, 37, 0.98); border: 1px solid rgba(128, 99, 231, 0.3); border-radius: 16px; padding: 35px; max-width: 420px; width: 90%; text-align: center; backdrop-filter: blur(10px); box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7); animation: slideUp 0.3s ease; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .confirm-modal-icon { width: 70px; height: 70px; margin: 0 auto 20px; background: rgba(128, 99, 231, 0.15); border: 2px solid rgba(128, 99, 231, 0.3); border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .confirm-modal-icon svg { width: 32px; height: 32px; stroke: #8063e7; }
        .confirm-modal-title { font-size: 22px; font-weight: 700; margin-bottom: 12px; }
        .confirm-modal-text { font-size: 14px; color: rgba(255, 255, 255, 0.7); line-height: 1.6; margin-bottom: 28px; }
        .confirm-modal-buttons { display: flex; gap: 12px; }
        .confirm-modal-btn { flex: 1; padding: 12px 20px; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s; border: none; }
        .confirm-modal-btn-cancel { background: rgba(255, 255, 255, 0.08); border: 1px solid rgba(255, 255, 255, 0.15); color: #fff; }
        .confirm-modal-btn-cancel:hover { background: rgba(255, 255, 255, 0.12); }
        .confirm-modal-btn-confirm { background: linear-gradient(135deg, #5c45af, #7c35ec); color: #fff; box-shadow: 0 4px 15px rgba(92, 69, 175, 0.3); }
        .confirm-modal-btn-confirm:hover { box-shadow: 0 6px 20px rgba(124, 53, 236, 0.5); transform: translateY(-1px); }
    </style>
</head>
<body>
    <div class="decorative-shape shape1"></div>
    <div class="decorative-shape shape2"></div>

    <div class="auth-container page-transition" id="loginPage">
        <div class="logo"><img src="https://i.ibb.co/DDyKRKY6/nuarrr.png" alt="Nuar"></div>
        <div class="auth-header">
            <h1 class="auth-title">Conta de usuário</h1>
            <p class="auth-subtitle">Uma única conta, Conteúdo infinitamente grátis</p>
        </div>
        <form class="auth-form" id="loginForm">
            <div class="input-group"><input type="email" class="auth-input" id="loginEmail" placeholder="Seu email" required></div>
            <div class="input-group"><input type="password" class="auth-input" id="loginPassword" placeholder="Sua senha" required></div>
            <div class="auth-options">
                <label class="remember-me"><input type="checkbox" id="rememberMe"><span>Lembrar a conta?</span></label>
            </div>
            <button type="submit" class="auth-submit"><span class="arrow-icon">→</span><span>Logar na Conta</span></button>
        </form>
        <div class="auth-footer">Ainda não é usuário? <a href="#" class="auth-switch" onclick="showRegister(event)">Faça seu Cadastro!</a></div>
        <div class="error-message" id="loginError"></div>
    </div>

    <div class="auth-container page-transition hidden" id="registerPage">
        <div class="logo"><img src="https://i.ibb.co/DDyKRKY6/nuarrr.png" alt="Nuar"></div>
        <div class="auth-header">
            <h1 class="auth-title">Novo Usuário</h1>
            <p class="auth-subtitle">Tenha acesso a sua conta em segundos</p>
        </div>
        <form class="auth-form" id="registerForm">
            <div class="input-group"><input type="text" class="auth-input" id="registerUsername" placeholder="Nome de usuário único" required></div>
            <div class="input-group"><input type="email" class="auth-input" id="registerEmail" placeholder="Seu email" required></div>
            <div class="input-group"><input type="password" class="auth-input" id="registerPassword" placeholder="Sua senha" required minlength="6"></div>
            <div class="input-group"><input type="password" class="auth-input" id="registerConfirmPassword" placeholder="Repita sua senha" required></div>
            <div class="input-group"><input type="text" class="auth-input" id="registerAccessCode" placeholder="Código de acesso" required></div>
            <p class="terms-text">Criando essa conta, você aceita os <a href="/termos.html" target="_blank">termos de responsabilidade</a></p>
            <button type="submit" class="auth-submit"><span class="arrow-icon">✓</span><span>Enviar Cadastro</span></button>
        </form>
        <div class="auth-footer">Já é usuário? <a href="#" class="auth-switch" onclick="showLogin(event)">Entre na sua conta!</a></div>
        <div class="error-message" id="registerError"></div>
    </div>

    <div class="confirm-modal" id="confirmModal">
        <div class="confirm-modal-content">
            <div class="confirm-modal-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/><path d="M9 12l2 2 4-4"/>
                </svg>
            </div>
            <h3 class="confirm-modal-title" id="confirmTitle">Confirmação</h3>
            <p class="confirm-modal-text" id="confirmText">Mensagem</p>
            <div class="confirm-modal-buttons">
                <button class="confirm-modal-btn confirm-modal-btn-cancel" id="confirmCancel">Cancelar</button>
                <button class="confirm-modal-btn confirm-modal-btn-confirm" id="confirmOk">OK</button>
            </div>
        </div>
    </div>

    <!-- Funções globais FORA do módulo -->
    <script>
        function showRegister(e) {
            e.preventDefault();
            const loginError = document.getElementById('loginError');
            const loginPage = document.getElementById('loginPage');
            const registerPage = document.getElementById('registerPage');
            loginError.classList.remove('show');
            loginPage.classList.add('hidden');
            registerPage.classList.remove('hidden');
        }

        function showLogin(e) {
            e.preventDefault();
            const registerError = document.getElementById('registerError');
            const loginPage = document.getElementById('loginPage');
            const registerPage = document.getElementById('registerPage');
            registerError.classList.remove('show');
            registerPage.classList.add('hidden');
            loginPage.classList.remove('hidden');
        }
    </script>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDHlEtmKXGeAsY9Ih-BBP-yiGrKJIKRD9k",
            authDomain: "nuarkowe.firebaseapp.com",
            projectId: "nuarkowe",
            storageBucket: "nuarkowe.firebasestorage.app",
            messagingSenderId: "1063041816951",
            appId: "1:1063041816951:web:0ffe4185fd0102b878e972"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const loginPage = document.getElementById('loginPage'), registerPage = document.getElementById('registerPage');
        const loginForm = document.getElementById('loginForm'), registerForm = document.getElementById('registerForm');
        const loginError = document.getElementById('loginError'), registerError = document.getElementById('registerError');

        function showError(el, msg, success = false) {
            el.textContent = msg;
            el.classList.toggle('success', success);
            el.classList.add('show');
            setTimeout(() => el.classList.remove('show'), 5000);
        }

        function hideError(el) { el.classList.remove('show'); }

        function showConfirm(msg) {
            return new Promise((resolve) => {
                const modal = document.getElementById('confirmModal');
                document.getElementById('confirmTitle').textContent = 'Confirmação';
                document.getElementById('confirmText').textContent = msg;
                modal.classList.add('active');
                
                const ok = () => { modal.classList.remove('active'); document.getElementById('confirmOk').removeEventListener('click', ok); document.getElementById('confirmCancel').removeEventListener('click', cancel); resolve(true); };
                const cancel = () => { modal.classList.remove('active'); document.getElementById('confirmOk').removeEventListener('click', ok); document.getElementById('confirmCancel').removeEventListener('click', cancel); resolve(false); };
                
                document.getElementById('confirmOk').addEventListener('click', ok);
                document.getElementById('confirmCancel').addEventListener('click', cancel);
            });
        }

        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            hideError(registerError);
            const btn = registerForm.querySelector('.auth-submit'), btnTxt = btn.querySelector('span:last-child');
            const username = document.getElementById('registerUsername').value.trim();
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            const accessCode = document.getElementById('registerAccessCode').value.trim();
            
            if (!username || !email || !password || !confirmPassword || !accessCode) return showError(registerError, 'Preencha todos os campos.');
            
            if (accessCode !== 'delinquentes') {
                showError(registerError, '❌ Código de acesso inválido. Cadastro bloqueado.');
                document.getElementById('registerAccessCode').value = '';
                document.getElementById('registerAccessCode').focus();
                return;
            }
            
            if (username.length < 3) return showError(registerError, 'Nome de usuário muito curto (mín. 3).');
            if (password !== confirmPassword) return showError(registerError, 'As senhas não coincidem.');
            if (password.length < 6) return showError(registerError, 'Senha muito curta (mín. 6).');
            
            btn.disabled = true;
            btnTxt.textContent = 'Cadastrando...';
            
            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                
                // Salvar dados no localStorage (sem precisar do Firestore)
                localStorage.setItem('nuarLoggedUser', JSON.stringify({
                    nome: username,
                    username: username,
                    email: email,
                    uid: user.uid,
                    avatar: null
                }));
                
                showError(registerError, `✓ Bem-vindo, ${username}!`, true);
                setTimeout(() => window.location.href = '/inicio.html', 1500);
            } catch (err) {
                let errorMsg = 'Erro ao criar conta';
                if (err.code === 'auth/email-already-in-use') errorMsg = 'Este email já está cadastrado';
                if (err.code === 'auth/weak-password') errorMsg = 'Senha muito fraca';
                showError(registerError, errorMsg);
            } finally {
                btn.disabled = false;
                btnTxt.textContent = 'Enviar Cadastro';
            }
        });

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            hideError(loginError);
            const btn = loginForm.querySelector('.auth-submit'), btnTxt = btn.querySelector('span:last-child');
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            const rememberMe = document.getElementById('rememberMe').checked;
            
            if (!email || !password) return showError(loginError, 'Preencha email e senha.');
            
            btn.disabled = true;
            btnTxt.textContent = 'Entrando...';
            
            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                
                // Salvar dados do usuário no localStorage
                localStorage.setItem('nuarLoggedUser', JSON.stringify({
                    nome: email.split('@')[0],
                    username: email.split('@')[0],
                    email: email,
                    uid: user.uid,
                    avatar: null
                }));
                
                if (rememberMe) {
                    localStorage.setItem('nuarRememberUser', JSON.stringify({
                        email: email,
                        uid: user.uid
                    }));
                }
                
                showError(loginError, '✓ Login realizado!', true);
                setTimeout(() => window.location.href = '/inicio.html', 1000);
            } catch (err) {
                let errorMsg = 'Email ou senha incorretos';
                if (err.code === 'auth/user-not-found') errorMsg = 'Usuário não encontrado';
                if (err.code === 'auth/wrong-password') errorMsg = 'Senha incorreta';
                showError(loginError, errorMsg);
            } finally {
                btn.disabled = false;
                btnTxt.textContent = 'Logar na Conta';
            }
        });

        document.querySelectorAll('.auth-input').forEach(input => {
            input.addEventListener('input', () => { hideError(loginError); hideError(registerError); });
        });
    </script>
</body>
</html>
